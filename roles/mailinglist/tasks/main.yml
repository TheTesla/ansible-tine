---

- name: configure mailman create site list
  debconf:
    name: mailman
    question: mailman/create_site_list
    value: true 
    vtype: note

- name: configure mailman site language
  debconf:
    name: mailman
    question: mailman/site_languages
    value: de
    vtype: multiselect

- name: install mailman
  apt:
    name: "{{ item }}"
    state: latest
  with_items:
    - mailman
  become: true
  become_method: sudo 

- name: Add mailman to apache2
  shell: "cp /etc/mailman/apache.conf /etc/apache2/sites-available/mailman.conf"
  args:
    executable: "/bin/bash"

- name: Activate cgid in apache2
  apache2_module:
    state: present
    name: cgid

- name: Activate mailman in apache2
  shell: "a2ensite mailman.conf"
  args:
    executable: "/bin/bash"

- name: Set list creators password
  shell: "mmsitepass {{ list_creators_passwd }}"
  args:
    executable: "/bin/bash"

- name: Add user postfix to group list
  user:
    name: postfix
    groups: list
    append: yes  

  #- name: rmlist
  #  shell: '/usr/sbin/rmlist mailman'
  #  args:
  #    executable: /bin/bash

- name: Newlist
  shell: 'echo -e "\n" | /usr/sbin/newlist mailman {{ mailman_email }} {{ mailman_passwd }}'
  args:
    executable: /bin/bash
  ignore_errors: yes
